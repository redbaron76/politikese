!function(t){(jQuery.browser=jQuery.browser||{}).mobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}(navigator.userAgent||navigator.vendor||window.opera),function(t,e,n,i){function o(n,i){this.w=t(e),this.el=t(n),this.options=t.extend({},p,i),this.init()}var s="ontouchstart"in e,r=function(){var t=n.createElement("div"),i=n.documentElement;if(!("pointerEvents"in t.style))return!1;t.style.pointerEvents="auto",t.style.pointerEvents="x",i.appendChild(t);var o=e.getComputedStyle&&"auto"===e.getComputedStyle(t,"").pointerEvents;return i.removeChild(t),!!o}(),a=s?"touchstart":"mousedown",l=s?"touchmove":"mousemove",d=s?"touchend":"mouseup";eCancel=s?"touchcancel":"mouseup";var p={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",notClass:"dd-not",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",emptyClass:"dd-empty",passiveClass:"dd-passive",expandBtnHTML:'<i data-action="expand" class="fa fa-plus-square"></i>',collapseBtnHTML:'<i data-action="collapse" class="fa fa-minus-square"></i>',group:0,maxDepth:5,threshold:20,dragReverse:!1,dropCallback:null};o.prototype={init:function(){var n=this;n.reset(),n.el.data("nestable-group",this.options.group),n.placeEl=t('<div class="'+n.options.placeClass+'"/>'),t.each(this.el.find(n.options.itemNodeName),function(e,i){n.setParent(t(i))}),n.el.on("click","i",function(e){if(!n.dragEl&&(s||0===e.button)){var i=t(e.currentTarget),o=i.data("action"),r=i.parent(n.options.itemNodeName);"collapse"===o&&n.collapseItem(r),"expand"===o&&n.expandItem(r)}});var i=function(e){var i=t(e.target);i.hasClass(n.options.handleClass)||(i=i.parents("."+n.options.handleClass).first()),!i.length||n.dragEl||!s&&0!==e.button||s&&1!==e.touches.length||(e.preventDefault(),n.dragStart(s?e.touches[0]:e))},o=function(t){n.dragEl&&(t.preventDefault(),n.dragMove(s?t.touches[0]:t))},r=function(t){n.dragEl&&(t.preventDefault(),n.dragStop(s?t.touches[0]:t))};s?(n.el[0].addEventListener(a,i,!1),e.addEventListener(l,o,!1),e.addEventListener(d,r,!1),e.addEventListener(eCancel,r,!1)):(n.el.on(a,i),n.w.on(l,o),n.w.on(d,r))},serialize:function(){var e,n=0,i=this;return step=function(e,n){var o=[],s=e.children(i.options.itemNodeName);return s.each(function(){var e=t(this),s=t.extend({},e.data()),r=e.children(i.options.listNodeName);r.length&&(s.children=step(r,n+1)),o.push(s)}),o},e=step(i.el.find(i.options.listNodeName).first(),n)},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(t){t.removeClass(this.options.collapsedClass),t.children('[data-action="expand"]').hide(),t.children('[data-action="collapse"]').show(),t.children(this.options.listNodeName).show()},collapseItem:function(t){var e=t.children(this.options.listNodeName);e.length&&(t.addClass(this.options.collapsedClass),t.children('[data-action="collapse"]').hide(),t.children('[data-action="expand"]').show(),t.children(this.options.listNodeName).hide())},expandAll:function(){var e=this;e.el.find(e.options.itemNodeName).each(function(){e.expandItem(t(this))})},collapseAll:function(){var e=this;e.el.find(e.options.itemNodeName).each(function(){e.collapseItem(t(this))})},setParent:function(e){e.children(this.options.listNodeName).length&&0==e.has("button").length&&(e.prepend(t(this.options.expandBtnHTML)),e.prepend(t(this.options.collapseBtnHTML))),e.children('[data-action="expand"]').hide()},unsetParent:function(t){t.removeClass(this.options.collapsedClass),t.children("[data-action]").remove(),t.children(this.options.listNodeName).remove()},dragStart:function(e){var o=this.mouse,s=t(e.target),r=s.parents(this.options.itemNodeName).first();if(!r.hasClass(this.options.notClass)){if(this.placeEl.css("height",r.height()),o.offsetX=e.offsetX!==i?e.offsetX:e.pageX-s.offset().left,o.offsetY=e.offsetY!==i?e.offsetY:e.pageY-s.offset().top,this.options.dragReverse){var a=r.width()-s.outerWidth();o.offsetX=e.pageX-s.offset().left+a}o.startX=o.lastX=e.pageX,o.startY=o.lastY=e.pageY,this.dragRootEl=this.el,this.dragEl=t(n.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",r.width()),r.after(this.placeEl),r[0].parentNode.removeChild(r[0]),r.appendTo(this.dragEl),t(n.body).append(this.dragEl),this.dragEl.css({left:e.pageX-o.offsetX,top:e.pageY-o.offsetY});var l,d,p=this.dragEl.find(this.options.itemNodeName);for(l=0;l<p.length;l++)d=t(p[l]).parents(this.options.listNodeName).length,d>this.dragDepth&&(this.dragDepth=d)}},dragStop:function(){var e=this.dragEl.children(this.options.itemNodeName).first();e[0].parentNode.removeChild(e[0]),this.placeEl.replaceWith(e),this.dragEl.remove(),this.el.trigger("reorder");var n=e.parent().parent(),i=null;null===n||n.is("."+this.options.rootClass)||(i=n.data("id")),t.isFunction(this.options.dropCallback)&&this.options.dropCallback.call(this,e.data("id"),e,i),this.hasNewRoot&&this.dragRootEl.trigger("reorder"),this.reset()},dragMove:function(e){var i,o,s,a,l,d=this.options,p=this.mouse;this.dragEl.css({left:e.pageX-p.offsetX,top:e.pageY-p.offsetY}),p.lastX=p.nowX,p.lastY=p.nowY,p.nowX=e.pageX,p.nowY=e.pageY,p.distX=p.nowX-p.lastX,p.distY=p.nowY-p.lastY,p.lastDirX=p.dirX,p.lastDirY=p.dirY,p.dirX=0===p.distX?0:p.distX>0?1:-1,p.dirY=0===p.distY?0:p.distY>0?1:-1;var u=Math.abs(p.distX)>Math.abs(p.distY)?1:0;if(!p.moving)return p.dirAx=u,void(p.moving=!0);p.dirAx!==u?(p.distAxX=0,p.distAxY=0):(p.distAxX+=Math.abs(p.distX),0!==p.dirX&&p.dirX!==p.lastDirX&&(p.distAxX=0),p.distAxY+=Math.abs(p.distY),0!==p.dirY&&p.dirY!==p.lastDirY&&(p.distAxY=0)),p.dirAx=u,p.dirAx&&p.distAxX>=d.threshold&&(p.distAxX=0,s=this.placeEl.prev(d.itemNodeName),p.distX>0&&s.length&&!s.hasClass(d.collapsedClass)&&(i=s.find(d.listNodeName).last(),l=this.placeEl.parents(d.listNodeName).length,l+this.dragDepth<=d.maxDepth&&(i.length?(i=s.children(d.listNodeName).last(),i.append(this.placeEl)):(i=t("<"+d.listNodeName+"/>").addClass(d.listClass),i.append(this.placeEl),s.append(i),this.setParent(s)))),p.distX<0&&(a=this.placeEl.next(d.itemNodeName),a.length||(o=this.placeEl.parent(),this.placeEl.parents(d.itemNodeName).first().after(this.placeEl),o.children().length||this.unsetParent(o.parent()))));var c=!1;if(r||(this.dragEl[0].style.visibility="hidden"),this.pointEl=t(n.elementFromPoint(e.pageX-n.body.scrollLeft,e.pageY-n.body.scrollTop)),r||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(d.handleClass)&&(this.pointEl=this.pointEl.parent(d.itemNodeName)),this.pointEl.hasClass(d.passiveClass)&&(this.pointEl=this.pointEl.parent(d.itemNodeName)),this.pointEl.hasClass(d.emptyClass))c=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(d.itemClass))return;var h=this.pointEl.parents("."+d.rootClass).first(),f=this.dragRootEl.data("nestable-id")!==h.data("nestable-id");if(!p.dirAx||f||c){if(f&&d.group!==h.data("nestable-group"))return;l=this.dragDepth-1+this.pointEl.parents(d.listNodeName).length;var g=e.pageY<this.pointEl.offset().top+this.pointEl.height()/2;o=this.placeEl.parent(),c?(i=t(n.createElement(d.listNodeName)).addClass(d.listClass),i.append(this.placeEl),this.pointEl.replaceWith(i)):g?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),o.children().length||this.unsetParent(o.parent()),this.dragRootEl.find(d.itemNodeName).length||this.dragRootEl.append('<div class="'+d.emptyClass+'"/>'),f&&(this.hasNewRoot=!0,this.dragRootEl=h)}}},t.fn.nestable=function(e){var n=this,i=this;return n.each(function(){var n=t(this).data("nestable");n?"string"==typeof e&&"function"==typeof n[e]&&(i=n[e]()):(t(this).data("nestable",new o(this,e)),t(this).data("nestable-id",(new Date).getTime()))}),i||n}}(window.jQuery||window.Zepto,window,document),function(t){t.LoadNext=function(e){var n={container:".ad-paginating",list_wrapper:"tbody",pag_list:".pagination",next:null,label:"Load next",btn_class:"btn",onClickNext:function(){},onLoadComplete:function(){}},i=t.extend(n,e),o=t(i.pag_list).hide(),s=i.next?t(i.next).attr("href"):o.find("li").last().find("a").attr("href"),r=t(i.container);if(s){var a=t("<a />").addClass(i.btn_class).attr("href",s).html(i.label).insertAfter(r);a.on("click",function(e){e.preventDefault(),i.onClickNext.call(this);var n=this,o=t(n).attr("href");t.get(o,null,function(e){var o=t(e).find(i.container).parents("form").children(),s=t(o[1]).find(i.list_wrapper+" > tr"),l=t(o[2]).find("li").last().find("a").attr("href");r.find(i.list_wrapper).append(s),l?(a.attr("href",l),i.onLoadComplete.call(n)):a.remove()})})}}}(jQuery),function(t,e){"function"==typeof define&&define.amd?define("sifter",e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){var t=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};t.prototype.tokenize=function(t){if(t=i(String(t||"").toLowerCase()),!t||!t.length)return[];var e,n,s,a,l=[],d=t.split(/ +/);for(e=0,n=d.length;n>e;e++){if(s=o(d[e]),this.settings.diacritics)for(a in r)r.hasOwnProperty(a)&&(s=s.replace(new RegExp(a,"g"),r[a]));l.push({string:d[e],regex:new RegExp(s,"i")})}return l},t.prototype.iterator=function(t,e){var n;n=s(t)?Array.prototype.forEach||function(t){for(var e=0,n=this.length;n>e;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)},n.apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var n,i,o,s;n=this,t=n.prepareSearch(t,e),o=t.tokens,i=t.options.fields,s=o.length;var r=function(t,e){var n,i;return t?(t=String(t||""),i=t.search(e.regex),-1===i?0:(n=e.string.length/t.length,0===i&&(n+=.5),n)):0},a=function(){var t=i.length;return t?1===t?function(t,e){return r(e[i[0]],t)}:function(e,n){for(var o=0,s=0;t>o;o++)s+=r(n[i[o]],e);return s/t}:function(){return 0}}();return s?1===s?function(t){return a(o[0],t)}:"and"===t.options.conjunction?function(t){for(var e,n=0,i=0;s>n;n++){if(e=a(o[n],t),0>=e)return 0;i+=e}return i/s}:function(t){for(var e=0,n=0;s>e;e++)n+=a(o[e],t);return n/s}:function(){return 0}},t.prototype.getSortFunction=function(t,n){var i,o,s,r,a,l,d,p,u,c,h;if(s=this,t=s.prepareSearch(t,n),h=!t.query&&n.sort_empty||n.sort,u=function(t,e){return"$score"===t?e.score:s.items[e.id][t]},a=[],h)for(i=0,o=h.length;o>i;i++)(t.query||"$score"!==h[i].field)&&a.push(h[i]);if(t.query){for(c=!0,i=0,o=a.length;o>i;i++)if("$score"===a[i].field){c=!1;break}c&&a.unshift({field:"$score",direction:"desc"})}else for(i=0,o=a.length;o>i;i++)if("$score"===a[i].field){a.splice(i,1);break}for(p=[],i=0,o=a.length;o>i;i++)p.push("desc"===a[i].direction?-1:1);return l=a.length,l?1===l?(r=a[0].field,d=p[0],function(t,n){return d*e(u(r,t),u(r,n))}):function(t,n){var i,o,s;for(i=0;l>i;i++)if(s=a[i].field,o=p[i]*e(u(s,t),u(s,n)))return o;return 0}:null},t.prototype.prepareSearch=function(t,e){if("object"==typeof t)return t;e=n({},e);var i=e.fields,o=e.sort,r=e.sort_empty;return i&&!s(i)&&(e.fields=[i]),o&&!s(o)&&(e.sort=[o]),r&&!s(r)&&(e.sort_empty=[r]),{options:e,query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,e){var n,i,o,s,r=this;return i=this.prepareSearch(t,e),e=i.options,t=i.query,s=e.score||r.getScoreFunction(i),t.length?r.iterator(r.items,function(t,o){n=s(t),(e.filter===!1||n>0)&&i.items.push({score:n,id:o})}):r.iterator(r.items,function(t,e){i.items.push({score:1,id:e})}),o=r.getSortFunction(i,e),o&&i.items.sort(o),i.total=i.items.length,"number"==typeof e.limit&&(i.items=i.items.slice(0,e.limit)),i};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:e>t?-1:0:(t=String(t||"").toLowerCase(),e=String(e||"").toLowerCase(),t>e?1:e>t?-1:0)},n=function(t){var e,n,i,o;for(e=1,n=arguments.length;n>e;e++)if(o=arguments[e])for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);return t},i=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},o=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||$&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚ]",i:"[iÌÍÎÏìíîï]",n:"[nÑñňŇ]",o:"[oÒÓÔÕÕÖØòóôõöø]",r:"[rřŘ]",s:"[sŠš]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮ]",y:"[yŸÿýÝ]",z:"[zŽž]"};return t}),function(t,e){"function"==typeof define&&define.amd?define("microplugin",e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={};t.mixin=function(t){t.plugins={},t.prototype.initializePlugins=function(t){var n,i,o,s=this,r=[];if(s.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(n=0,i=t.length;i>n;n++)"string"==typeof t[n]?r.push(t[n]):(s.plugins.settings[t[n].name]=t[n].options,r.push(t[n].name));else if(t)for(o in t)t.hasOwnProperty(o)&&(s.plugins.settings[o]=t[o],r.push(o));for(;r.length;)s.require(r.shift())},t.prototype.loadPlugin=function(e){var n=this,i=n.plugins,o=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=o.fn.apply(n,[n.plugins.settings[e]||{}]),i.names.push(e)},t.prototype.require=function(t){var e=this,n=e.plugins;if(!e.plugins.loaded.hasOwnProperty(t)){if(n.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');e.loadPlugin(t)}return n.loaded[t]},t.define=function(e,n){t.plugins[e]={name:e,fn:n}}};var e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define("selectize",["jquery","sifter","microplugin"],e):"object"==typeof exports?module.exports=e(require("jquery"),require("sifter"),require("microplugin")):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(t,e,n){"use strict";var i=function(t,e){if("string"!=typeof e||e.length){var n="string"==typeof e?new RegExp(e,"i"):e,i=function(t){var e=0;if(3===t.nodeType){var o=t.data.search(n);if(o>=0&&t.data.length>0){var s=t.data.match(n),r=document.createElement("span");r.className="highlight";var a=t.splitText(o),l=(a.splitText(s[0].length),a.cloneNode(!0));r.appendChild(l),a.parentNode.replaceChild(r,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var d=0;d<t.childNodes.length;++d)d+=i(t.childNodes[d]);return e};return t.each(function(){i(this)})}},o=function(){};o.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},o.mixin=function(t){for(var e=["on","off","trigger"],n=0;n<e.length;n++)t.prototype[e[n]]=o.prototype[e[n]]};var s=/Mac/.test(navigator.userAgent),r=65,a=13,l=27,d=37,p=38,u=80,c=39,h=40,f=78,g=8,m=46,v=16,y=s?91:17,w=s?18:17,b=9,C=1,D=2,O=function(t){return"undefined"!=typeof t},$=function(t){return"undefined"==typeof t||null===t?"":"boolean"==typeof t?t?"1":"0":t+""},x=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},S=function(t){return(t+"").replace(/\$/g,"$$$$")},j={};j.before=function(t,e,n){var i=t[e];t[e]=function(){return n.apply(t,arguments),i.apply(t,arguments)}},j.after=function(t,e,n){var i=t[e];t[e]=function(){var e=i.apply(t,arguments);return n.apply(t,arguments),e}};var k=function(e,n){if(!t.isArray(n))return n;var i,o,s={};for(i=0,o=n.length;o>i;i++)n[i].hasOwnProperty(e)&&(s[n[i][e]]=n[i]);return s},I=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},N=function(t,e){var n;return function(){var i=this,o=arguments;window.clearTimeout(n),n=window.setTimeout(function(){t.apply(i,o)},e)}},_=function(t,e,n){var i,o=t.trigger,s={};t.trigger=function(){var n=arguments[0];return-1===e.indexOf(n)?o.apply(t,arguments):void(s[n]=arguments)},n.apply(t,[]),t.trigger=o;for(i in s)s.hasOwnProperty(i)&&o.apply(t,s[i])},A=function(t,e,n,i){t.on(e,n,function(e){for(var n=e.target;n&&n.parentNode!==t[0];)n=n.parentNode;return e.currentTarget=n,i.apply(this,[e])})},E=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-t.value.length),e.start=n.text.length-i,e.length=i}return e},P=function(t,e,n){var i,o,s={};if(n)for(i=0,o=n.length;o>i;i++)s[n[i]]=t.css(n[i]);else s=t.css();e.css(s)},T=function(e,n){if(!e)return 0;var i=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(e).appendTo("body");P(n,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var o=i.width();return i.remove(),o},F=function(t){var e=null,n=function(n,i){var o,s,r,a,l,d,p,u;n=n||window.event||{},i=i||{},n.metaKey||n.altKey||(i.force||t.data("grow")!==!1)&&(o=t.val(),n.type&&"keydown"===n.type.toLowerCase()&&(s=n.keyCode,r=s>=97&&122>=s||s>=65&&90>=s||s>=48&&57>=s||32===s,s===m||s===g?(u=E(t[0]),u.length?o=o.substring(0,u.start)+o.substring(u.start+u.length):s===g&&u.start?o=o.substring(0,u.start-1)+o.substring(u.start+1):s===m&&"undefined"!=typeof u.start&&(o=o.substring(0,u.start)+o.substring(u.start+1))):r&&(d=n.shiftKey,p=String.fromCharCode(n.keyCode),p=d?p.toUpperCase():p.toLowerCase(),o+=p)),a=t.attr("placeholder"),!o&&a&&(o=a),l=T(o,t)+4,l!==e&&(e=l,t.width(l),t.triggerHandler("resize")))};t.on("keydown keyup update blur",n),n()},z=function(n,i){var o,s,r=this;s=n[0],s.selectize=r,o=window.getComputedStyle?window.getComputedStyle(s,null).getPropertyValue("direction"):s.currentStyle&&s.currentStyle.direction,o=o||n.parents("[dir]:first").attr("dir")||"",t.extend(r,{settings:i,$input:n,tagType:"select"===s.tagName.toLowerCase()?C:D,rtl:/rtl/i.test(o),eventNS:".selectize"+ ++z.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:n.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:null===i.loadThrottle?r.onSearchChange:N(r.onSearchChange,i.loadThrottle)}),r.sifter=new e(this.options,{diacritics:i.diacritics}),t.extend(r.options,k(i.valueField,i.options)),delete r.settings.options,t.extend(r.optgroups,k(i.optgroupValueField,i.optgroups)),delete r.settings.optgroups,r.settings.mode=r.settings.mode||(1===r.settings.maxItems?"single":"multi"),"boolean"!=typeof r.settings.hideSelected&&(r.settings.hideSelected="multi"===r.settings.mode),r.initializePlugins(r.settings.plugins),r.setupCallbacks(),r.setupTemplates(),r.setup()};return o.mixin(z),n.mixin(z),t.extend(z.prototype,{setup:function(){var e,n,i,o,r,a,l,d,p,u,c=this,h=c.settings,f=c.eventNS,g=t(window),m=t(document);l=c.settings.mode,d=c.$input.attr("tabindex")||"",p=c.$input.attr("class")||"",e=t("<div>").addClass(h.wrapperClass).addClass(p).addClass(l),n=t("<div>").addClass(h.inputClass).addClass("items").appendTo(e),i=t('<input type="text" autocomplete="off" />').appendTo(n).attr("tabindex",d),a=t(h.dropdownParent||e),o=t("<div>").addClass(h.dropdownClass).addClass(p).addClass(l).hide().appendTo(a),r=t("<div>").addClass(h.dropdownContentClass).appendTo(o),e.css({width:c.$input[0].style.width}),c.plugins.names.length&&(u="plugin-"+c.plugins.names.join(" plugin-"),e.addClass(u),o.addClass(u)),(null===h.maxItems||h.maxItems>1)&&c.tagType===C&&c.$input.attr("multiple","multiple"),c.settings.placeholder&&i.attr("placeholder",h.placeholder),c.$input.attr("autocorrect")&&i.attr("autocorrect",c.$input.attr("autocorrect")),c.$input.attr("autocapitalize")&&i.attr("autocapitalize",c.$input.attr("autocapitalize")),c.$wrapper=e,c.$control=n,c.$control_input=i,c.$dropdown=o,c.$dropdown_content=r,o.on("mouseenter","[data-selectable]",function(){return c.onOptionHover.apply(c,arguments)}),o.on("mousedown","[data-selectable]",function(){return c.onOptionSelect.apply(c,arguments)}),A(n,"mousedown","*:not(input)",function(){return c.onItemSelect.apply(c,arguments)}),F(i),n.on({mousedown:function(){return c.onMouseDown.apply(c,arguments)},click:function(){return c.onClick.apply(c,arguments)}}),i.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return c.onKeyDown.apply(c,arguments)},keyup:function(){return c.onKeyUp.apply(c,arguments)},keypress:function(){return c.onKeyPress.apply(c,arguments)},resize:function(){c.positionDropdown.apply(c,[])},blur:function(){return c.onBlur.apply(c,arguments)},focus:function(){return c.onFocus.apply(c,arguments)},paste:function(){return c.onPaste.apply(c,arguments)}}),m.on("keydown"+f,function(t){c.isCmdDown=t[s?"metaKey":"ctrlKey"],c.isCtrlDown=t[s?"altKey":"ctrlKey"],c.isShiftDown=t.shiftKey}),m.on("keyup"+f,function(t){t.keyCode===w&&(c.isCtrlDown=!1),t.keyCode===v&&(c.isShiftDown=!1),t.keyCode===y&&(c.isCmdDown=!1)}),m.on("mousedown"+f,function(t){if(c.isFocused){if(t.target===c.$dropdown[0]||t.target.parentNode===c.$dropdown[0])return!1;c.$control.has(t.target).length||t.target===c.$control[0]||c.blur()}}),g.on(["scroll"+f,"resize"+f].join(" "),function(){c.isOpen&&c.positionDropdown.apply(c,arguments)}),g.on("mousemove"+f,function(){c.ignoreHover=!1}),this.revertSettings={$children:c.$input.children().detach(),tabindex:c.$input.attr("tabindex")},c.$input.attr("tabindex",-1).hide().after(c.$wrapper),t.isArray(h.items)&&(c.setValue(h.items),delete h.items),c.$input[0].validity&&c.$input.on("invalid"+f,function(t){t.preventDefault(),c.isInvalid=!0,c.refreshState()}),c.updateOriginalInput(),c.refreshItems(),c.refreshState(),c.updatePlaceholder(),c.isSetup=!0,c.$input.is(":disabled")&&c.disable(),c.on("change",this.onChange),c.trigger("initialize"),h.preload===!0&&c.onSearchChange("")},setupTemplates:function(){var e=this,n=e.settings.labelField,i=e.settings.optgroupLabelField,o={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[n])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[n])+"</div>"},option_create:function(t,e){return'<div class="create">Add <strong>'+e(t.input)+"</strong>&hellip;</div>"}};e.settings.render=t.extend({},o,e.settings.render)},setupCallbacks:function(){var t,e,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(t in n)n.hasOwnProperty(t)&&(e=this.settings[n[t]],e&&this.on(t,e))},onClick:function(t){var e=this;e.isFocused||(e.focus(),t.preventDefault())},onMouseDown:function(e){{var n=this,i=e.isDefaultPrevented();t(e.target)}if(n.isFocused){if(e.target!==n.$control_input[0])return"single"===n.settings.mode?n.isOpen?n.close():n.open():i||n.setActiveItem(null),!1}else i||window.setTimeout(function(){n.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var e=this;(e.isFull()||e.isInputHidden||e.isLocked)&&t.preventDefault()},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(t){var e=(t.target===this.$control_input[0],this);if(e.isLocked)return void(t.keyCode!==b&&t.preventDefault());switch(t.keyCode){case r:if(e.isCmdDown)return void e.selectAll();break;case l:return void e.close();case f:if(!t.ctrlKey||t.altKey)break;case h:if(!e.isOpen&&e.hasOptions)e.open();else if(e.$activeOption){e.ignoreHover=!0;var n=e.getAdjacentOption(e.$activeOption,1);n.length&&e.setActiveOption(n,!0,!0)}return void t.preventDefault();case u:if(!t.ctrlKey||t.altKey)break;case p:if(e.$activeOption){e.ignoreHover=!0;var i=e.getAdjacentOption(e.$activeOption,-1);i.length&&e.setActiveOption(i,!0,!0)}return void t.preventDefault();case a:return e.isOpen&&e.$activeOption&&e.onOptionSelect({currentTarget:e.$activeOption}),void t.preventDefault();case d:return void e.advanceSelection(-1,t);case c:return void e.advanceSelection(1,t);case b:return e.settings.selectOnTab&&e.isOpen&&e.$activeOption&&e.onOptionSelect({currentTarget:e.$activeOption}),void(e.settings.create&&e.createItem()&&t.preventDefault());case g:case m:return void e.deleteSelection(t)}return!e.isFull()&&!e.isInputHidden||(s?t.metaKey:t.ctrlKey)?void 0:void t.preventDefault()},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var n=e.$control_input.val()||"";e.lastValue!==n&&(e.lastValue=n,e.onSearchChange(n),e.refreshOptions(),e.trigger("type",n))},onSearchChange:function(t){var e=this,n=e.settings.load;n&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(i){n.apply(e,[t,i])})))},onFocus:function(t){var e=this;return e.isFocused=!0,e.isDisabled?(e.blur(),t&&t.preventDefault(),!1):void(e.ignoreFocus||("focus"===e.settings.preload&&e.onSearchChange(""),e.$activeItems.length||(e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus)),e.refreshState()))},onBlur:function(){var t=this;t.isFocused=!1,t.ignoreFocus||(t.settings.create&&t.settings.createOnBlur&&t.createItem(!1),t.close(),t.setTextboxValue(""),t.setActiveItem(null),t.setActiveOption(null),t.setCaret(t.items.length),t.refreshState())},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var n,i,o=this;e.preventDefault&&(e.preventDefault(),e.stopPropagation()),i=t(e.currentTarget),i.hasClass("create")?o.createItem():(n=i.attr("data-value"),n&&(o.lastQuery=null,o.setTextboxValue(""),o.addItem(n),!o.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&o.setActiveOption(o.getOption(n))))},onItemSelect:function(t){var e=this;e.isLocked||"multi"===e.settings.mode&&(t.preventDefault(),e.setActiveItem(t.currentTarget,t))},load:function(t){var e=this,n=e.$wrapper.addClass("loading");e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(e.isFocused&&!e.isInputHidden)),e.loading||n.removeClass("loading"),e.trigger("load",t)}])},setTextboxValue:function(t){var e=this.$control_input,n=e.val()!==t;n&&(e.val(t).triggerHandler("update"),this.lastValue=t)},getValue:function(){return this.tagType===C&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(t){_(this,["change"],function(){this.clear(),this.addItems(t)})},setActiveItem:function(e,n){var i,o,s,r,a,l,d,p,u=this;if("single"!==u.settings.mode){if(e=t(e),!e.length)return t(u.$activeItems).removeClass("active"),u.$activeItems=[],void(u.isFocused&&u.showInput());if(i=n&&n.type.toLowerCase(),"mousedown"===i&&u.isShiftDown&&u.$activeItems.length){for(p=u.$control.children(".active:last"),r=Array.prototype.indexOf.apply(u.$control[0].childNodes,[p[0]]),a=Array.prototype.indexOf.apply(u.$control[0].childNodes,[e[0]]),r>a&&(d=r,r=a,a=d),o=r;a>=o;o++)l=u.$control[0].childNodes[o],-1===u.$activeItems.indexOf(l)&&(t(l).addClass("active"),u.$activeItems.push(l));n.preventDefault()}else"mousedown"===i&&u.isCtrlDown||"keydown"===i&&this.isShiftDown?e.hasClass("active")?(s=u.$activeItems.indexOf(e[0]),u.$activeItems.splice(s,1),e.removeClass("active")):u.$activeItems.push(e.addClass("active")[0]):(t(u.$activeItems).removeClass("active"),u.$activeItems=[e.addClass("active")[0]]);u.hideInput(),this.isFocused||u.focus()}},setActiveOption:function(e,n,i){var o,s,r,a,l,d=this;d.$activeOption&&d.$activeOption.removeClass("active"),d.$activeOption=null,e=t(e),e.length&&(d.$activeOption=e.addClass("active"),(n||!O(n))&&(o=d.$dropdown_content.height(),s=d.$activeOption.outerHeight(!0),n=d.$dropdown_content.scrollTop()||0,r=d.$activeOption.offset().top-d.$dropdown_content.offset().top+n,a=r,l=r-o+s,r+s>o+n?d.$dropdown_content.stop().animate({scrollTop:l},i?d.settings.scrollDuration:0):n>r&&d.$dropdown_content.stop().animate({scrollTop:a},i?d.settings.scrollDuration:0)))},selectAll:function(){var t=this;"single"!==t.settings.mode&&(t.$activeItems=Array.prototype.slice.apply(t.$control.children(":not(input)").addClass("active")),t.$activeItems.length&&(t.hideInput(),t.close()),t.focus())},hideInput:function(){var t=this;t.setTextboxValue(""),t.$control_input.css({opacity:0,position:"absolute",left:t.rtl?1e4:-1e4}),t.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var t=this;t.isDisabled||(t.ignoreFocus=!0,t.$control_input[0].focus(),window.setTimeout(function(){t.ignoreFocus=!1,t.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var t=this.settings,e=t.sortField;return"string"==typeof e&&(e={field:e}),{fields:t.searchField,conjunction:t.searchConjunction,sort:e}},search:function(e){var n,i,o,s=this,r=s.settings,a=this.getSearchOptions();if(r.score&&(o=s.settings.score.apply(this,[e]),"function"!=typeof o))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==s.lastQuery?(s.lastQuery=e,i=s.sifter.search(e,t.extend(a,{score:o})),s.currentResults=i):i=t.extend(!0,{},s.currentResults),r.hideSelected)for(n=i.items.length-1;n>=0;n--)-1!==s.items.indexOf($(i.items[n].id))&&i.items.splice(n,1);
return i},refreshOptions:function(e){var n,o,s,r,a,l,d,p,u,c,h,f,g,m,v,y;"undefined"==typeof e&&(e=!0);var w=this,b=w.$control_input.val(),C=w.search(b),D=w.$dropdown_content,O=w.$activeOption&&$(w.$activeOption.attr("data-value"));if(r=C.items.length,"number"==typeof w.settings.maxOptions&&(r=Math.min(r,w.settings.maxOptions)),a={},w.settings.optgroupOrder)for(l=w.settings.optgroupOrder,n=0;n<l.length;n++)a[l[n]]=[];else l=[];for(n=0;r>n;n++)for(d=w.options[C.items[n].id],p=w.render("option",d),u=d[w.settings.optgroupField]||"",c=t.isArray(u)?u:[u],o=0,s=c&&c.length;s>o;o++)u=c[o],w.optgroups.hasOwnProperty(u)||(u=""),a.hasOwnProperty(u)||(a[u]=[],l.push(u)),a[u].push(p);for(h=[],n=0,r=l.length;r>n;n++)u=l[n],w.optgroups.hasOwnProperty(u)&&a[u].length?(f=w.render("optgroup_header",w.optgroups[u])||"",f+=a[u].join(""),h.push(w.render("optgroup",t.extend({},w.optgroups[u],{html:f})))):h.push(a[u].join(""));if(D.html(h.join("")),w.settings.highlight&&C.query.length&&C.tokens.length)for(n=0,r=C.tokens.length;r>n;n++)i(D,C.tokens[n].regex);if(!w.settings.hideSelected)for(n=0,r=w.items.length;r>n;n++)w.getOption(w.items[n]).addClass("selected");g=w.settings.create&&C.query.length,g&&(D.prepend(w.render("option_create",{input:b})),y=t(D[0].childNodes[0])),w.hasOptions=C.items.length>0||g,w.hasOptions?(C.items.length>0?(v=O&&w.getOption(O),v&&v.length?m=v:"single"===w.settings.mode&&w.items.length&&(m=w.getOption(w.items[0])),m&&m.length||(m=y&&!w.settings.addPrecedence?w.getAdjacentOption(y,1):D.find("[data-selectable]:first"))):m=y,w.setActiveOption(m),e&&!w.isOpen&&w.open()):(w.setActiveOption(null),e&&w.isOpen&&w.close())},addOption:function(e){var n,i,o,s=this;if(t.isArray(e))for(n=0,i=e.length;i>n;n++)s.addOption(e[n]);else o=$(e[s.settings.valueField]),o&&!s.options.hasOwnProperty(o)&&(s.userOptions[o]=!0,s.options[o]=e,s.lastQuery=null,s.trigger("option_add",o,e))},addOptionGroup:function(t,e){this.optgroups[t]=e,this.trigger("optgroup_add",t,e)},updateOption:function(e,n){var i,o,s,r,a,l,d=this;if(e=$(e),s=$(n[d.settings.valueField]),d.options.hasOwnProperty(e)){if(!s)throw new Error("Value must be set in option data");s!==e&&(delete d.options[e],r=d.items.indexOf(e),-1!==r&&d.items.splice(r,1,s)),d.options[s]=n,a=d.renderCache.item,l=d.renderCache.option,a&&(delete a[e],delete a[s]),l&&(delete l[e],delete l[s]),-1!==d.items.indexOf(s)&&(i=d.getItem(e),o=t(d.render("item",n)),i.hasClass("active")&&o.addClass("active"),i.replaceWith(o)),d.isOpen&&d.refreshOptions(!1)}},removeOption:function(t){var e=this;t=$(t);var n=e.renderCache.item,i=e.renderCache.option;n&&delete n[t],i&&delete i[t],delete e.userOptions[t],delete e.options[t],e.lastQuery=null,e.trigger("option_remove",t),e.removeItem(t)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.renderCache={},t.options=t.sifter.items={},t.lastQuery=null,t.trigger("option_clear"),t.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,n){var i=this.$dropdown.find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},getElementWithValue:function(e,n){if(e=$(e))for(var i=0,o=n.length;o>i;i++)if(n[i].getAttribute("data-value")===e)return t(n[i]);return t()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItems:function(e){for(var n=t.isArray(e)?e:[e],i=0,o=n.length;o>i;i++)this.isPending=o-1>i,this.addItem(n[i])},addItem:function(e){_(this,["change"],function(){var n,i,o,s,r=this,a=r.settings.mode;return e=$(e),-1!==r.items.indexOf(e)?void("single"===a&&r.close()):void(r.options.hasOwnProperty(e)&&("single"===a&&r.clear(),"multi"===a&&r.isFull()||(n=t(r.render("item",r.options[e])),r.items.splice(r.caretPos,0,e),r.insertAtCaret(n),r.refreshState(),r.isSetup&&(o=r.$dropdown_content.find("[data-selectable]"),this.isPending||(i=r.getOption(e),s=r.getAdjacentOption(i,1).attr("data-value"),r.refreshOptions(r.isFocused&&"single"!==a),s&&r.setActiveOption(r.getOption(s))),!o.length||null!==r.settings.maxItems&&r.items.length>=r.settings.maxItems?r.close():r.positionDropdown(),r.updatePlaceholder(),r.trigger("item_add",e,n),r.updateOriginalInput()))))})},removeItem:function(t){var e,n,i,o=this;e="object"==typeof t?t:o.getItem(t),t=$(e.attr("data-value")),n=o.items.indexOf(t),-1!==n&&(e.remove(),e.hasClass("active")&&(i=o.$activeItems.indexOf(e[0]),o.$activeItems.splice(i,1)),o.items.splice(n,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(t)&&o.removeOption(t),n<o.caretPos&&o.setCaret(o.caretPos-1),o.refreshState(),o.updatePlaceholder(),o.updateOriginalInput(),o.positionDropdown(),o.trigger("item_remove",t))},createItem:function(e){var n=this,i=t.trim(n.$control_input.val()||""),o=n.caretPos;if(!i.length)return!1;n.lock(),"undefined"==typeof e&&(e=!0);var s="function"==typeof n.settings.create?this.settings.create:function(t){var e={};return e[n.settings.labelField]=t,e[n.settings.valueField]=t,e},r=I(function(t){if(n.unlock(),t&&"object"==typeof t){var i=$(t[n.settings.valueField]);i&&(n.setTextboxValue(""),n.addOption(t),n.setCaret(o),n.addItem(i),n.refreshOptions(e&&"single"!==n.settings.mode))}}),a=s.apply(this,[i,r]);return"undefined"!=typeof a&&r(a),!0},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var t=0;t<this.items.length;t++)this.addItem(this.items);this.refreshState(),this.updateOriginalInput()},refreshState:function(){var t=this,e=t.isRequired&&!t.items.length;e||(t.isInvalid=!1),t.$control_input.prop("required",e),t.refreshClasses()},refreshClasses:function(){var e=this,n=e.isFull(),i=e.isLocked;e.$wrapper.toggleClass("rtl",e.rtl),e.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("required",e.isRequired).toggleClass("invalid",e.isInvalid).toggleClass("locked",i).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("input-active",e.isFocused&&!e.isInputHidden).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!t.isEmptyObject(e.options)).toggleClass("has-items",e.items.length>0),e.$control_input.data("grow",!n&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var t,e,n,i=this;if("select"===i.$input[0].tagName.toLowerCase()){for(n=[],t=0,e=i.items.length;e>t;t++)n.push('<option value="'+x(i.items[t])+'" selected="selected"></option>');n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),i.$input.html(n.join(""))}else i.$input.val(i.getValue());i.isSetup&&i.trigger("change",i.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update",{force:!0})}},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(),t.isOpen=!0,t.refreshState(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",t.$dropdown))},close:function(){var t=this,e=t.isOpen;"single"===t.settings.mode&&t.items.length&&t.hideInput(),t.isOpen=!1,t.$dropdown.hide(),t.setActiveOption(null),t.refreshState(),e&&t.trigger("dropdown_close",t.$dropdown)},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.setCaret(0),t.updatePlaceholder(),t.updateOriginalInput(),t.refreshState(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(e){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(e):t(this.$control[0].childNodes[n]).before(e),this.setCaret(n+1)},deleteSelection:function(e){var n,i,o,s,r,a,l,d,p,u=this;if(o=e&&e.keyCode===g?-1:1,s=E(u.$control_input[0]),u.$activeOption&&!u.settings.hideSelected&&(l=u.getAdjacentOption(u.$activeOption,-1).attr("data-value")),r=[],u.$activeItems.length){for(p=u.$control.children(".active:"+(o>0?"last":"first")),a=u.$control.children(":not(input)").index(p),o>0&&a++,n=0,i=u.$activeItems.length;i>n;n++)r.push(t(u.$activeItems[n]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(u.isFocused||"single"===u.settings.mode)&&u.items.length&&(0>o&&0===s.start&&0===s.length?r.push(u.items[u.caretPos-1]):o>0&&s.start===u.$control_input.val().length&&r.push(u.items[u.caretPos]));if(!r.length||"function"==typeof u.settings.onDelete&&u.settings.onDelete.apply(u,[r])===!1)return!1;for("undefined"!=typeof a&&u.setCaret(a);r.length;)u.removeItem(r.pop());return u.showInput(),u.positionDropdown(),u.refreshOptions(!0),l&&(d=u.getOption(l),d.length&&u.setActiveOption(d)),!0},advanceSelection:function(t,e){var n,i,o,s,r,a,l=this;0!==t&&(l.rtl&&(t*=-1),n=t>0?"last":"first",i=E(l.$control_input[0]),l.isFocused&&!l.isInputHidden?(s=l.$control_input.val().length,r=0>t?0===i.start&&0===i.length:i.start===s,r&&!s&&l.advanceCaret(t,e)):(a=l.$control.children(".active:"+n),a.length&&(o=l.$control.children(":not(input)").index(a),l.setActiveItem(null),l.setCaret(t>0?o+1:o))))},advanceCaret:function(t,e){var n,i,o=this;0!==t&&(n=t>0?"next":"prev",o.isShiftDown?(i=o.$control_input[n](),i.length&&(o.hideInput(),o.setActiveItem(i),e&&e.preventDefault())):o.setCaret(o.caretPos+t))},setCaret:function(e){var n=this;e="single"===n.settings.mode?n.items.length:Math.max(0,Math.min(n.items.length,e));var i,o,s,r;for(s=n.$control.children(":not(input)"),i=0,o=s.length;o>i;i++)r=t(s[i]).detach(),e>i?n.$control_input.before(r):n.$control.append(r);n.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var t=this;t.$input.prop("disabled",!0),t.isDisabled=!0,t.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.isDisabled=!1,t.unlock()},destroy:function(){var e=this,n=e.eventNS,i=e.revertSettings;e.trigger("destroy"),e.off(),e.$wrapper.remove(),e.$dropdown.remove(),e.$input.html("").append(i.$children).removeAttr("tabindex").attr({tabindex:i.tabindex}).show(),t(window).off(n),t(document).off(n),t(document.body).off(n),delete e.$input[0].selectize},render:function(t,e){var n,i,o="",s=!1,r=this,a=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===t||"item"===t)&&(n=$(e[r.settings.valueField]),s=!!n),s&&(O(r.renderCache[t])||(r.renderCache[t]={}),r.renderCache[t].hasOwnProperty(n))?r.renderCache[t][n]:(o=r.settings.render[t].apply(this,[e,x]),("option"===t||"option_create"===t)&&(o=o.replace(a,"<$1 data-selectable")),"optgroup"===t&&(i=e[r.settings.optgroupValueField]||"",o=o.replace(a,'<$1 data-group="'+S(x(i))+'"')),("option"===t||"item"===t)&&(o=o.replace(a,'<$1 data-value="'+S(x(n||""))+'"')),s&&(r.renderCache[t][n]=o),o)}}),z.count=0,z.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,createOnBlur:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},t.fn.selectize=function(e){var n=t.fn.selectize.defaults,i=t.extend({},n,e),o=i.dataAttr,s=i.labelField,r=i.valueField,a=i.optgroupField,l=i.optgroupLabelField,d=i.optgroupValueField,p=function(e,n){var o,a,l,d,p=t.trim(e.val()||"");if(p.length){for(l=p.split(i.delimiter),o=0,a=l.length;a>o;o++)d={},d[s]=l[o],d[r]=l[o],n.options[l[o]]=d;n.items=l}},u=function(e,n){var i,p,u,c,h=0,f=n.options,g=function(t){var e=o&&t.attr(o);return"string"==typeof e&&e.length?JSON.parse(e):null},m=function(e,i){var o,l;if(e=t(e),o=e.attr("value")||"",o.length){if(f.hasOwnProperty(o))return void(i&&(f[o].optgroup?t.isArray(f[o].optgroup)?f[o].optgroup.push(i):f[o].optgroup=[f[o].optgroup,i]:f[o].optgroup=i));l=g(e)||{},l[s]=l[s]||e.text(),l[r]=l[r]||o,l[a]=l[a]||i,l.$order=++h,f[o]=l,e.is(":selected")&&n.items.push(o)}},v=function(e){var i,o,s,r,a;for(e=t(e),s=e.attr("label"),s&&(r=g(e)||{},r[l]=s,r[d]=s,n.optgroups[s]=r),a=t("option",e),i=0,o=a.length;o>i;i++)m(a[i],s)};for(n.maxItems=e.attr("multiple")?null:1,c=e.children(),i=0,p=c.length;p>i;i++)u=c[i].tagName.toLowerCase(),"optgroup"===u?v(c[i]):"option"===u&&m(c[i])};return this.each(function(){if(!this.selectize){var i,o=t(this),s=this.tagName.toLowerCase(),r={placeholder:o.children('option[value=""]').text()||o.attr("placeholder"),options:{},optgroups:{},items:[]};"select"===s?u(o,r):p(o,r),i=new z(o,t.extend(!0,{},n,r,e)),o.data("selectize",i),o.addClass("selectized")}})},t.fn.selectize.defaults=z.defaults,z.define("drag_drop",function(){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var e=this;e.lock=function(){var t=e.lock;return function(){var n=e.$control.data("sortable");return n&&n.disable(),t.apply(e,arguments)}}(),e.unlock=function(){var t=e.unlock;return function(){var n=e.$control.data("sortable");return n&&n.enable(),t.apply(e,arguments)}}(),e.setup=function(){var n=e.setup;return function(){n.apply(this,arguments);var i=e.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:e.isLocked,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var n=e.$activeItems?e.$activeItems.slice():null,o=[];i.children("[data-value]").each(function(){o.push(t(this).attr("data-value"))}),e.setValue(o),e.setActiveItem(n)}})}}()}}),z.define("dropdown_header",function(e){var n=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'}},e),n.setup=function(){var i=n.setup;return function(){i.apply(n,arguments),n.$dropdown_header=t(e.html(e)),n.$dropdown.prepend(n.$dropdown_header)}}()}),z.define("optgroup_columns",function(e){var n=this;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,n){var i=e.closest("[data-group]").find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},this.onKeyDown=function(){var t=n.onKeyDown;return function(e){var i,o,s,r;return!this.isOpen||e.keyCode!==d&&e.keyCode!==c?t.apply(this,arguments):(n.ignoreHover=!0,r=this.$activeOption.closest("[data-group]"),i=r.find("[data-selectable]").index(this.$activeOption),r=e.keyCode===d?r.prev("[data-group]"):r.next("[data-group]"),s=r.find("[data-selectable]"),o=s.eq(Math.min(s.length-1,i)),void(o.length&&this.setActiveOption(o)))}}();var i=function(){var i,o,s,r,a,l,d;if(d=t("[data-group]",n.$dropdown_content),o=d.length,o&&n.$dropdown_content.width()){if(e.equalizeHeight){for(s=0,i=0;o>i;i++)s=Math.max(s,d.eq(i).height());d.css({height:s})}e.equalizeWidth&&(l=n.$dropdown_content.innerWidth(),r=Math.round(l/o),d.css({width:r}),o>1&&(a=l-r*(o-1),d.eq(o-1).css({width:a})))}};(e.equalizeHeight||e.equalizeWidth)&&(j.after(this,"positionDropdown",i),j.after(this,"refreshOptions",i))}),z.define("remove_button",function(e){if("single"!==this.settings.mode){e=t.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e);var n=this,i='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+x(e.title)+'">'+e.label+"</a>",o=function(t,e){var n=t.search(/(<\/[^>]+>\s*)$/);return t.substring(0,n)+e+t.substring(n)};this.setup=function(){var s=n.setup;return function(){if(e.append){var r=n.settings.render.item;n.settings.render.item=function(){return o(r.apply(this,arguments),i)}}s.apply(this,arguments),this.$control.on("click","."+e.className,function(e){if(e.preventDefault(),!n.isLocked){var i=t(e.currentTarget).parent();n.setActiveItem(i),n.deleteSelection()&&n.setCaret(n.items.length)}})}}()}}),z.define("restore_on_backspace",function(t){var e=this;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=function(){var n=e.onKeyDown;return function(e){var i,o;return e.keyCode===g&&""===this.$control_input.val()&&!this.$activeItems.length&&(i=this.caretPos-1,i>=0&&i<this.items.length)?(o=this.options[this.items[i]],this.deleteSelection(e)&&(this.setTextboxValue(t.text.apply(this,[o])),this.refreshOptions(!0)),void e.preventDefault()):n.apply(this,arguments)}}()}),z}),jQuery.tableDnD={currentTable:null,dragObject:null,mouseOffset:null,oldY:0,build:function(t){return t=t||{},this.each(function(){this.tableDnDConfig={onDragStyle:t.onDragStyle,onDropStyle:t.onDropStyle,onDragClass:t.onDragClass?t.onDragClass:"tDnD_whileDrag",onDrop:t.onDrop,onDragStart:t.onDragStart,scrollAmount:t.scrollAmount?t.scrollAmount:5},jQuery.tableDnD.makeDraggable(this)}),jQuery(document).on("mousemove",jQuery.tableDnD.mousemove).on("mouseup",jQuery.tableDnD.mouseup),this},makeDraggable:function(t){var e=t.tableDnDConfig;jQuery(t).on("mousedown","tr",function(n){var i=$(this);return i.hasClass("nodrag")||"TD"!=n.target.tagName?void 0:(jQuery.tableDnD.dragObject=this,jQuery.tableDnD.currentTable=t,jQuery.tableDnD.mouseOffset=jQuery.tableDnD.getMouseOffset(this,n),e.onDragStart&&e.onDragStart(t,this),!1)}),jQuery(t).find("tr").not(".nodrag").css("cursor","move")},mouseCoords:function(t){return t.pageX||t.pageY?{x:t.pageX,y:t.pageY}:{x:t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.clientY+document.body.scrollTop-document.body.clientTop}},getMouseOffset:function(t,e){e=e||window.event;var n=this.getPosition(t),i=this.mouseCoords(e);return{x:i.x-n.x,y:i.y-n.y}},getPosition:function(t){var e=0,n=0;for(0==t.offsetHeight&&(t=t.firstChild);t.offsetParent;)e+=t.offsetLeft,n+=t.offsetTop,t=t.offsetParent;return e+=t.offsetLeft,n+=t.offsetTop,{x:e,y:n}},mousemove:function(t){if(null!=jQuery.tableDnD.dragObject){var e=jQuery(jQuery.tableDnD.dragObject),n=jQuery.tableDnD.currentTable.tableDnDConfig,i=jQuery.tableDnD.mouseCoords(t),o=i.y-jQuery.tableDnD.mouseOffset.y,s=window.pageYOffset;if(document.all&&("undefined"!=typeof document.compatMode&&"BackCompat"!=document.compatMode?s=document.documentElement.scrollTop:"undefined"!=typeof document.body&&(s=document.body.scrollTop)),i.y-s<n.scrollAmount)window.scrollBy(0,-n.scrollAmount);else{var r=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight;r-(i.y-s)<n.scrollAmount&&window.scrollBy(0,n.scrollAmount)}if(o!=jQuery.tableDnD.oldY){var a=o>jQuery.tableDnD.oldY;jQuery.tableDnD.oldY=o,n.onDragClass?e.addClass(n.onDragClass):e.css(n.onDragStyle);var l=jQuery.tableDnD.findDropTargetRow(e,o);l&&(a&&jQuery.tableDnD.dragObject!=l?jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject,l.nextSibling):a||jQuery.tableDnD.dragObject==l||jQuery.tableDnD.dragObject.parentNode.insertBefore(jQuery.tableDnD.dragObject,l))}return!1}},findDropTargetRow:function(t,e){for(var n=jQuery.tableDnD.currentTable.rows,i=0;i<n.length;i++){var o=n[i],s=this.getPosition(o).y,r=parseInt(o.offsetHeight)/2;if(0==o.offsetHeight&&(s=this.getPosition(o.firstChild).y,r=parseInt(o.firstChild.offsetHeight)/2),e>s-r&&s+r>e){if(o==t)return null;var a=jQuery.tableDnD.currentTable.tableDnDConfig;if(a.onAllowDrop)return a.onAllowDrop(t,o)?o:null;var l=$(o).hasClass("nodrop");return l?null:o}}return null},mouseup:function(){if(jQuery.tableDnD.currentTable&&jQuery.tableDnD.dragObject){var t=jQuery.tableDnD.dragObject,e=jQuery.tableDnD.currentTable.tableDnDConfig;e.onDragClass?jQuery(t).removeClass(e.onDragClass):jQuery(t).css(e.onDropStyle),jQuery.tableDnD.dragObject=null,e.onDrop&&e.onDrop(jQuery.tableDnD.currentTable,t,jQuery(t).data("id")),jQuery.tableDnD.currentTable=null}},serialize:function(){if(jQuery.tableDnD.currentTable){for(var t="",e=(jQuery.tableDnD.currentTable.id,jQuery.tableDnD.currentTable.rows),n=0;n<e.length;n++)t.length>0&&(t+=","),t+=jQuery(e[n]).data("id");return t}return"Error: No Table id set, you need to set an id on your table and every row"}},jQuery.fn.extend({tableDnD:jQuery.tableDnD.build});